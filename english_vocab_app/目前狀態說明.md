# 目前單字表系統狀態說明

## 1. 單字表檔案內容

### 目前存在的檔案

#### `assets/data/sample_words.json` (目前正在使用)
```json
[
  {
    "word": "abandon",
    "translation": "放棄；遺棄",
    "partOfSpeech": "動詞",
    "exampleEn": "She had to abandon the car in the snow.",
    "exampleZh": "她不得不在雪地裡棄車。",
    "cambridgeUrl": "https://dictionary.cambridge.org/dictionary/english-chinese-traditional/abandon",
    "level": 4,
    "audioUrl": ""
  },
  {
    "word": "boost",
    "translation": "提高；增加",
    "partOfSpeech": "動詞",
    "exampleEn": "Extra study sessions can boost your exam confidence.",
    "exampleZh": "額外的複習課可以提升你考試的信心。",
    "cambridgeUrl": "https://dictionary.cambridge.org/dictionary/english-chinese-traditional/boost",
    "level": 4,
    "audioUrl": ""
  },
  {
    "word": "clarify",
    "translation": "澄清；闡明",
    "partOfSpeech": "動詞",
    "exampleEn": "The teacher clarified the instructions before the test.",
    "exampleZh": "老師在考試前澄清了指示。",
    "cambridgeUrl": "https://dictionary.cambridge.org/dictionary/english-chinese-traditional/clarify",
    "level": 4,
    "audioUrl": ""
  },
  {
    "word": "diverse",
    "translation": "多樣的；各種各樣的",
    "partOfSpeech": "形容詞",
    "exampleEn": "The reading list covers diverse topics.",
    "exampleZh": "閱讀清單涵蓋了多樣的主題。",
    "cambridgeUrl": "https://dictionary.cambridge.org/dictionary/english-chinese-traditional/diverse",
    "level": 4,
    "audioUrl": ""
  },
  {
    "word": "estimate",
    "translation": "估計；估算",
    "partOfSpeech": "動詞",
    "exampleEn": "Can you estimate how many words are required for the exam?",
    "exampleZh": "你能估計考試需要背多少單字嗎？",
    "cambridgeUrl": "https://dictionary.cambridge.org/dictionary/english-chinese-traditional/estimate",
    "level": 4,
    "audioUrl": ""
  }
]
```

**狀態**: 只有 5 個單字，都是第 4 級

#### `assets/data/words.json`
**狀態**: ❌ 不存在（這就是為什麼應用程式只顯示 5 個單字）

#### `scripts/words_input.txt`
**格式**: 
```
第一級

a/an art.

ability n.

able adj.

about prep./adv.
...
```

**狀態**: 包含所有級別的單字列表，但格式是：
- 級別標題（如「第一級」）
- 空行
- 單字和詞性（如「a/an art.」）
- 空行
- 下一個單字...

**問題**: 這個檔案**沒有中文翻譯**，只有英文單字和詞性

---

## 2. 載入單字表的程式碼

### Flutter/Dart 程式碼

#### `lib/core/models/word_entry.dart` - 資料模型
```dart
import 'dart:convert';

class WordEntry {
  const WordEntry({
    required this.word,
    required this.translation,
    required this.partOfSpeech,
    required this.exampleEn,
    required this.exampleZh,
    required this.cambridgeUrl,
    required this.level,
    this.audioUrl,
  });

  final String word;
  final String translation;
  final String partOfSpeech;
  final String exampleEn;
  final String exampleZh;
  final String cambridgeUrl;
  final int level; // 1-6 級
  final String? audioUrl;

  factory WordEntry.fromJson(Map<String, dynamic> json) {
    return WordEntry(
      word: json['word'] as String? ?? '',
      translation: json['translation'] as String? ?? '',
      partOfSpeech: json['partOfSpeech'] as String? ?? '',
      exampleEn: json['exampleEn'] as String? ?? '',
      exampleZh: json['exampleZh'] as String? ?? '',
      cambridgeUrl: json['cambridgeUrl'] as String? ?? '',
      level: json['level'] as int? ?? 1,
      audioUrl: json['audioUrl'] as String?,
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'word': word,
      'translation': translation,
      'partOfSpeech': partOfSpeech,
      'exampleEn': exampleEn,
      'exampleZh': exampleZh,
      'cambridgeUrl': cambridgeUrl,
      'level': level,
      'audioUrl': audioUrl,
    };
  }

  static List<WordEntry> decodeList(String jsonStr) {
    final rawList = json.decode(jsonStr) as List<dynamic>;
    return rawList
        .map((item) => WordEntry.fromJson(item as Map<String, dynamic>))
        .toList();
  }
}
```

#### `lib/core/repositories/word_repository.dart` - 資料載入邏輯
```dart
import 'package:flutter/services.dart' show AssetBundle, rootBundle;

import '../models/word_entry.dart';

class WordRepository {
  WordRepository({AssetBundle? bundle})
      : _bundle = bundle ?? rootBundle,
        _cache = const <WordEntry>[];

  final AssetBundle _bundle;
  List<WordEntry> _cache;

  Future<List<WordEntry>> loadWords({int? level}) async {
    if (_cache.isEmpty) {
      // 先嘗試載入 words.json，如果不存在則使用 sample_words.json
      try {
        final raw = await _bundle.loadString('assets/data/words.json');
        _cache = WordEntry.decodeList(raw);
      } catch (e) {
        // 如果 words.json 不存在，使用 sample_words.json
        final raw = await _bundle.loadString('assets/data/sample_words.json');
        _cache = WordEntry.decodeList(raw);
      }
    }
    
    if (level != null) {
      return _cache.where((word) => word.level == level).toList();
    }
    
    return _cache;
  }
  
  List<int> getAvailableLevels() {
    if (_cache.isEmpty) {
      return [];
    }
    return _cache.map((w) => w.level).toSet().toList()..sort();
  }
}
```

**載入邏輯**:
1. 優先嘗試載入 `assets/data/words.json`
2. 如果失敗（檔案不存在），則載入 `assets/data/sample_words.json`
3. 目前因為 `words.json` 不存在，所以只載入了 5 個單字

---

### Python 處理腳本

#### `scripts/create_complete_words.py` - 從 words_input.txt 生成 JSON
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
直接生成包含所有學測英文單字的 JSON 文件
此腳本會處理用戶提供的完整單字列表文本
"""

import json
import re
import sys

def extract_base_word(word: str) -> str:
    """提取單字的基本形式"""
    if '/' in word:
        word = word.split('/')[0]
    word = re.sub(r'\([^)]+\)', '', word)
    return word.strip().lower()

def generate_cambridge_url(word: str) -> str:
    """生成劍橋字典連結"""
    base_word = extract_base_word(word)
    return f"https://dictionary.cambridge.org/dictionary/english-chinese-traditional/{base_word}"

def parse_word_line(line: str, level: int):
    """解析單行單字"""
    line = line.strip()
    if not line:
        return None
    
    # 匹配格式: word pos. 或 word/word pos.
    pattern = r'^([a-zA-Z\-\'\/\s\(\)]+?)\s+([a-z\.\/\(\)]+)$'
    match = re.match(pattern, line)
    if not match:
        return None
    
    word_part = match.group(1).strip()
    pos_part = match.group(2).strip()
    
    base_word = extract_base_word(word_part)
    if not base_word or len(base_word) < 1:
        return None
    
    return {
        'word': base_word,
        'translation': '',  # 待補充 - 這是問題所在！
        'partOfSpeech': pos_part,
        'exampleEn': '',
        'exampleZh': '',
        'cambridgeUrl': generate_cambridge_url(base_word),
        'level': level,
        'audioUrl': ''
    }

def main():
    # 從標準輸入或文件讀取
    if len(sys.argv) > 1:
        with open(sys.argv[1], 'r', encoding='utf-8') as f:
            text = f.read()
    else:
        with open('words_input.txt', 'r', encoding='utf-8') as f:
            text = f.read()
    
    words = []
    current_level = 0
    
    for line in text.split('\n'):
        line = line.strip()
        
        # 檢測級別
        if '第一級' in line or line == '第一級':
            current_level = 1
            continue
        elif '第二級' in line or line == '第二級':
            current_level = 2
            continue
        elif '第三級' in line or line == '第三級':
            current_level = 3
            continue
        elif '第四級' in line or line == '第四級':
            current_level = 4
            continue
        elif '第五級' in line or line == '第五級':
            current_level = 5
            continue
        elif '第六級' in line or line == '第六級':
            current_level = 6
            continue
        
        if not line or '級' in line:
            continue
        
        if current_level > 0:
            entry = parse_word_line(line, current_level)
            if entry:
                words.append(entry)
    
    # 統計
    level_counts = {}
    for w in words:
        level_counts[w['level']] = level_counts.get(w['level'], 0) + 1
    
    print(f"共 {len(words)} 個單字")
    for level in sorted(level_counts.keys()):
        print(f"第{level}級: {level_counts[level]} 個")
    
    # 保存
    output = '../assets/data/words.json'
    with open(output, 'w', encoding='utf-8') as f:
        json.dump(words, f, ensure_ascii=False, indent=2)
    
    print(f"已保存到 {output}")

if __name__ == '__main__':
    main()
```

**問題**: 這個腳本生成的 JSON 中，`translation` 欄位是空的，因為 `words_input.txt` 沒有中文翻譯

---

#### `scripts/立即生成words_json.ps1` - PowerShell 腳本（處理 tab 分隔格式）
這個腳本期望的格式是：`級別\t單字\t屬性\t輸出\t中文`

但 `words_input.txt` 的格式不同，所以無法使用。

---

## 3. Cursor 指令和系統 Prompt

### 用戶給 Cursor 的主要指令

1. **初始需求**:
   ```
   第一級 ... zoo n. 第二級 ... zebra n. 第三級 ... zone n./v. 
   第四級 ... youthful adj. 第五級 ... yield v./n. 第六級 ... zoom v./n 
   這些單字的中文翻譯幫我用劍橋字典查
   ```

2. **問題回報**:
   ```
   他現在跑不出單字了 怎麼辦
   ```

3. **級別問題**:
   ```
   為甚麼單字量這麼少 還有不是要照大學入學考試中心的標準分成六級嗎 
   為甚麼只有看到第四級而已
   ```

4. **添加完整單字列表**:
   ```
   請把這個網址上的單字加進去
   [提供了包含級別、單字、屬性、輸出、中文的完整 tab 分隔數據]
   ```

5. **持續問題**:
   ```
   還是一樣只有五個單字
   一樣沒有請解決
   沒有用 單字一直都是五個
   ```

### 系統 Prompt 相關內容（從對話歷史推斷）

**核心任務**:
- 建立 Flutter 應用程式，用於學習 GEPT（全民英檢）英文單字
- 將單字分類為六個級別（根據大學入學考試中心標準）
- 以閃卡形式顯示單字
- 顯示總單字數、已掌握單字數、已複習單字數
- 提供功能：播放發音、顯示中文翻譯、標記為已掌握、稍後複習、查詢劍橋字典

**技術要求**:
- Flutter/Dart
- Riverpod 狀態管理
- JSON 資料處理
- 資產管理（assets/data/words.json）

**資料結構要求**:
- 每個單字必須包含：word, translation, partOfSpeech, exampleEn, exampleZh, cambridgeUrl, level (1-6), audioUrl

---

## 4. 目前問題總結

### 核心問題
1. **`words.json` 不存在** → 應用程式只能載入 `sample_words.json`（只有 5 個單字）
2. **`words_input.txt` 沒有中文翻譯** → 即使生成 JSON，translation 欄位也是空的
3. **用戶提供的完整數據（包含中文翻譯）沒有被正確處理** → 用戶提供了 tab 分隔格式的完整數據，但沒有成功生成 `words.json`

### 需要的解決方案
1. 找到或重新獲取用戶提供的完整數據（包含中文翻譯）
2. 建立腳本處理 tab 分隔格式：`級別\t單字\t屬性\t輸出\t中文`
3. 成功生成包含所有單字和翻譯的 `words.json`
4. 確保應用程式能正確載入 `words.json`

---

## 5. 建議的下一步

1. **確認數據來源**: 檢查是否有包含中文翻譯的原始數據檔案
2. **建立處理腳本**: 建立能處理 tab 分隔格式的腳本
3. **生成 words.json**: 執行腳本生成完整的 `words.json`
4. **驗證**: 重新運行 Flutter 應用程式，確認所有單字都能顯示

